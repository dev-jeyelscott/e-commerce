name: codereview

permissions:
  contents: read
  pull-requests: write

on:
  pull_request:
    types: [opened, reopened, synchronize]

jobs:
  code-review:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: AI Code Review
        uses: anc95/ChatGPT-CodeReview@main
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

          USE_GITHUB_MODELS: true
          MODEL: openai/gpt-4o

          LANGUAGE: English
          PROMPT: |
            Act as a senior Laravel engineer.
            Perform a production-grade review.
            Focus on security, validation, authorization, N+1 queries,
            migrations safety, queue usage, and test coverage.
            Flag anything that would block a merge.

          TEMPERATURE: 0.3
          TOP_P: 1
          MAX_TOKENS: 4000

          IGNORE_PATTERNS: |
            /node_modules/**
            /vendor/**
            *.md

          INCLUDE_PATTERNS: |
            *.js
            *.ts
            *.php
            *.blade.php
            *.json
